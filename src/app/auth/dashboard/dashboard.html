<div class="main-container">
  <div class="top-bar">
    <h1 class="app-title">Flight Dashboard</h1>

    <div class="top-actions">
      <button (click)="showSearch()">Search Flights</button>
      <button (click)="showBookings()">My Bookings</button>
      <button (click)="showPnrSearch()">Get Ticket by PNR</button>
      <button *ngIf="isAdmin()" (click)="showAddFlight()" style="background-color: #ef4444">
        Add Flight
      </button>
    </div>
  </div>

  <div *ngIf="!selectedFlight()">
    <h2 class="page-title">Search Flights</h2>

    <div class="search-card">
      <form (ngSubmit)="onSearch()">
        <div class="row">
          <label
            style="
              flex: 1;
              display: flex;
              align-items: center;
              gap: 10px;
              color: #e5e7eb;
              font-size: 13px;
            "
          >
            <span>Trip</span>
            <select [(ngModel)]="searchRequest.tripType" name="tripType">
              <option value="ONE_WAY">One way</option>
              <option value="ROUND_TRIP">Round trip</option>
            </select>
          </label>
        </div>

        <div class="row">
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span
              style="
                font-size: 12px;
                color: #9ca3af;
                text-transform: uppercase;
                letter-spacing: 0.06em;
              "
            >
              From
            </span>
            <input
              type="text"
              placeholder="City or airport"
              [(ngModel)]="searchRequest.fromPlace"
              name="fromPlace"
              required
            />
          </div>

          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span
              style="
                font-size: 12px;
                color: #9ca3af;
                text-transform: uppercase;
                letter-spacing: 0.06em;
              "
            >
              To
            </span>
            <input
              type="text"
              placeholder="City or airport"
              [(ngModel)]="searchRequest.toPlace"
              name="toPlace"
              required
            />
          </div>
        </div>

        <div class="row">
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span
              style="
                font-size: 12px;
                color: #9ca3af;
                text-transform: uppercase;
                letter-spacing: 0.06em;
              "
            >
              Departure
            </span>
            <input type="date" [(ngModel)]="searchRequest.travelDate" name="travelDate" required />
          </div>

          <div
            style="flex: 1; display: flex; flex-direction: column; gap: 4px"
            *ngIf="searchRequest.tripType === 'ROUND_TRIP'"
          >
            <span
              style="
                font-size: 12px;
                color: #9ca3af;
                text-transform: uppercase;
                letter-spacing: 0.06em;
              "
            >
              Return
            </span>
            <input type="date" [(ngModel)]="searchRequest.returnDate" name="returnDate" />
          </div>
        </div>
        <button type="submit">Search flights</button>
      </form>
    </div>
    <div *ngIf="loading()" class="loading">Searching flights…</div>

    <div *ngIf="!loading() && flights().length === 0" class="no-results">
      No flights found. Try different dates or airports.
    </div>

    <div class="results" *ngIf="!loading() && flights().length > 0">
      <div class="flight-card" *ngFor="let flight of flights()">
        <div style="display: flex; justify-content: space-between; align-items: baseline">
          <h3>{{ flight.airlineName }} ({{ flight.flightNumber }})</h3>
          <span style="font-size: 13px; font-weight: 600; color: #facc15">
            ₹{{ flight.oneWayPrice || flight.roundTripPrice }}
          </span>
        </div>

        <p>
          <strong>Departure:</strong>
          {{ flight.departureTime | date : 'MMM d, y, h:mm a' }}<br />
          <strong>Arrival:</strong>
          {{ flight.arrivalTime | date : 'MMM d, y, h:mm a' }}
        </p>

        <p *ngIf="flight.message" class="info">
          {{ flight.message }}
        </p>

        <div style="display: flex; justify-content: flex-end; margin-top: 10px">
          <button class="book-btn" (click)="bookFlight(flight)">Book Ticket</button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="selectedFlight() as flight" class="booking-container">
    <h2 class="title">Passenger Details</h2>
    <p style="color: white; margin-bottom: 20px">
      Booking for: <b>{{ flight.airlineName }} ({{ flight.flightNumber }})</b>
    </p>

    <div class="search-card">
      <form (ngSubmit)="confirmBooking()">
        <div class="row">
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span class="label-text">Contact Email</span>
            <input
              type="email"
              [(ngModel)]="bookingRequest.email"
              name="email"
              readonly
              class="readonly-input"
              placeholder="your@email.com"
            />
          </div>
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span class="label-text">Number of Seats</span>
            <input
              type="number"
              [(ngModel)]="bookingRequest.numberOfSeats"
              name="numSeats"
              (change)="generatePassengerFields()"
              min="1"
              max="10"
            />
          </div>
        </div>

        <hr style="border: 0.5px solid #334155; margin: 20px 0" />
        <div *ngFor="let p of bookingRequest.passengers; let i = index" class="passenger-box">
          <h4 style="color: #38bdf8; margin-bottom: 10px">Passenger {{ i + 1 }}</h4>

          <div class="row">
            <input
              type="text"
              [(ngModel)]="p.name"
              name="name{{ i }}"
              placeholder="Full Name"
              required
            />
            <input type="number" [(ngModel)]="p.age" name="age{{ i }}" placeholder="Age" required />
          </div>

          <div class="row">
            <select [(ngModel)]="p.gender" name="gender{{ i }}">
              <option value="MALE">Male</option>
              <option value="FEMALE">Female</option>
            </select>
            <select [(ngModel)]="p.meal" name="meal{{ i }}">
              <option value="VEG">Veg</option>
              <option value="NON_VEG">Non-Veg</option>
            </select>
            <select [(ngModel)]="p.fareCategory" name="fare{{ i }}">
              <option value="GENERAL">General</option>
              <option value="STUDENT">STUDENT</option>
              <option value="ARMY">ARMY</option>
            </select>
          </div>
        </div>

        <div class="button-group">
          <button type="submit" class="confirm-btn">Confirm Booking</button>
          <button type="button" (click)="cancelBooking()" class="cancel-btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  <!-- MY BOOKINGS SECTION -->
  <div *ngIf="view === 'BOOKINGS'" class="booking-history">
    <h2 class="page-title">My Booking History</h2>

    <div *ngIf="bookings.length === 0" class="no-results">No bookings found.</div>

    <div class="ticket-container">
      <div class="pro-ticket" *ngFor="let b of bookings">
        <!-- Left Side: Flight Info -->
        <div class="ticket-main">
          <div class="ticket-header">
            <span class="airline-name">{{ b.airlineName }}</span>
            <span class="flight-no">{{ b.flightNumber }}</span>
            <span class="pnr-badge">PNR: {{ b.pnr }}</span>
          </div>

          <div class="ticket-body">
            <div class="route">
              <div class="station">
                <span class="city">{{ b.fromPlace }}</span>
                <span class="label">From</span>
              </div>
              <div class="plane-icon">✈</div>
              <div class="station">
                <span class="city">{{ b.toPlace }}</span>
                <span class="label">To</span>
              </div>
            </div>

            <div class="info-grid">
              <div class="info-item">
                <span class="label">Date</span>
                <span class="val">{{ b.travelDate | date : 'mediumDate' }}</span>
              </div>
              <div class="info-item">
                <span class="label">Status</span>
                <span class="val status-confirmed">Confirmed</span>
              </div>
            </div>

            <div class="passenger-section">
              <span class="label">Passengers</span>
              <div class="pass-list">
                <span *ngFor="let p of b.passengers" class="pass-tag">
                  {{ p.name }} ({{ p.age }}y)
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Side: Actions -->
        <div class="ticket-actions">
          <button class="cancel-ticket-btn" (click)="cancelBookingById(b.pnr)">
            Cancel Booking
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- PNR SEARCH SECTION -->
  <div *ngIf="view === 'PNR'" class="pnr-box">
    <h2 class="page-title">Digital Ticket Retrieval</h2>

    <div class="pnr-search-bar">
      <input type="text" [(ngModel)]="pnr" placeholder="Enter PNR Number (e.g. OJ5KKW)" />
      <button (click)="getTicketByPnr()">Search Ticket</button>
    </div>

    <!-- SHOW THIS IF TICKET IS NOT FOUND -->
    <div
      *ngIf="pnrErrorMessage"
      class="no-results"
      style="
        margin-top: 20px;
        color: #f87171;
        border: 1px dashed #f87171;
        padding: 20px;
        border-radius: 8px;
      "
    >
      {{ pnrErrorMessage }}
    </div>

    <!-- SHOW TICKET IF FOUND -->
    <div *ngIf="pnrTicket" class="ticket-container" style="margin-top: 30px">
      <div class="pro-ticket">
        <!-- ... keep your existing ticket-main and ticket-actions code here ... -->
        <div class="ticket-main">
          <div class="ticket-header">
            <span class="airline-name">{{ pnrTicket.airlineName }}</span>
            <span class="pnr-badge">PNR: {{ pnrTicket.pnr }}</span>
          </div>
          <!-- details... -->
        </div>
      </div>
    </div>
  </div>
  <!-- ADD FLIGHT FORM -->
  <div *ngIf="view === 'ADD_FLIGHT'" class="booking-container">
    <h2 class="page-title">Add New Flight Inventory</h2>

    <div class="search-card">
      <form (ngSubmit)="onAddFlight()">
        <div class="row">
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span class="label-text">Airline Name</span>
            <input type="text" [(ngModel)]="newFlight.airlineName" name="airlineName" required />
          </div>
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span class="label-text">Flight Number</span>
            <input type="text" [(ngModel)]="newFlight.flightNumber" name="flightNumber" required />
          </div>
        </div>

        <div class="row">
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span class="label-text">From</span>
            <input type="text" [(ngModel)]="newFlight.fromPlace" name="fromPlace" required />
          </div>
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span class="label-text">To</span>
            <input type="text" [(ngModel)]="newFlight.toPlace" name="toPlace" required />
          </div>
        </div>

        <div class="row">
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span class="label-text">Departure Time</span>
            <input
              type="datetime-local"
              [(ngModel)]="newFlight.departureTime"
              name="deptTime"
              required
            />
          </div>
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span class="label-text">Arrival Time</span>
            <input
              type="datetime-local"
              [(ngModel)]="newFlight.arrivalTime"
              name="arrTime"
              required
            />
          </div>
        </div>

        <!-- ADDED SPECIAL FARE AND CATEGORY HERE -->
        <div class="row">
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span class="label-text">Regular Price</span>
            <input type="number" [(ngModel)]="newFlight.price" name="price" required />
          </div>
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span class="label-text">Special Fare</span>
            <input type="number" [(ngModel)]="newFlight.specialFare" name="specFare" required />
          </div>
        </div>

        <div class="row">
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span class="label-text">Fare Category</span>
            <select [(ngModel)]="newFlight.fareCategory" name="fareCat">
              <option value="STUDENT">STUDENT</option>
              <option value="GENERAL">GENERAL</option>
              <option value="ARMY">ARMY</option>
            </select>
          </div>
          <div style="flex: 1; display: flex; flex-direction: column; gap: 4px">
            <span class="label-text">Total Seats</span>
            <input type="number" [(ngModel)]="newFlight.totalSeats" name="seats" required />
          </div>
        </div>

        <div class="button-group" style="margin-top: 20px">
          <button type="submit" class="confirm-btn">SAVE FLIGHT</button>
          <button type="button" (click)="showSearch()" class="cancel-btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
